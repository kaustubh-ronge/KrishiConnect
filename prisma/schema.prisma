generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model User {
  id    String @id @unique 
  email String @unique
  role  String

  farmerProfile FarmerProfile?
  agentProfile  AgentProfile?

  orders Order[] @relation("BuyerOrders")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("users")
}


model FarmerProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name     String
  farmName String?
  phone    String?
  address  String?

  aadharNumber      String?  @unique
  farmSize          Float? 
  primaryProduce    String[] 
  farmingExperience Int? 

  upiId         String?
  bankName      String?
  accountNumber String?
  ifscCode      String?

  listings ProductListing[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("farmer_profiles")
}

model AgentProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name        String
  companyName String?
  phone       String?
  region      String?

  agentType   String[]

  upiId         String?
  bankName      String?
  accountNumber String?
  ifscCode      String?

  listings ProductListing[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("agent_profiles")
}


model ProductListing {
  id String @id @default(cuid())

  
  productName String
  variety     String? 
  description String? 

  images String[] 

  quantityLabel    String 
  availableStock   Float 
  unit             String 
  pricePerUnit     Float 
  minOrderQuantity Float? 

  harvestDate  DateTime?
  shelfLifeStartDate DateTime?
  qualityGrade String? 
  shelfLife    String? 

  whatsappNumber String? 

  isAvailable Boolean @default(true)

  sellerType String 
  farmerId   String?
  farmer     FarmerProfile? @relation(fields: [farmerId], references: [id])
  agentId    String?
  agent      AgentProfile?  @relation(fields: [agentId], references: [id])

  orderItems OrderItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("product_listings")
}



model Order {
  id String @id @default(cuid())

  buyerId   String
  buyerUser User   @relation("BuyerOrders", fields: [buyerId], references: [id])

  
  totalAmount  Float 
  platformFee  Float 
  sellerAmount Float 

  paymentStatus   String  @default("PENDING") 
  razorpayOrderId String? 

  orderStatus String @default("PROCESSING") 

  items OrderItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("orders")
}

model OrderItem {
  id      String @id @default(cuid())
  orderId String
  order   Order  @relation(fields: [orderId], references: [id])

  productId String
  product   ProductListing @relation(fields: [productId], references: [id])

  quantity        Float 
  priceAtPurchase Float

  @@map("order_items")
}
